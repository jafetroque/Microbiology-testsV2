<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microbe Test Quiz</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Custom Button Styles for Quiz */
        .option-btn { transition: all 0.2s; }
        .option-btn:active { transform: scale(0.98); }
        
        /* Correct/Incorrect States */
        .correct-answer { background-color: #dcfce7 !important; border-color: #22c55e !important; color: #15803d !important; }
        .wrong-answer { background-color: #fee2e2 !important; border-color: #ef4444 !important; color: #b91c1c !important; opacity: 0.6; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col items-center p-4">

    <!-- HEADER -->
    <header class="w-full max-w-md flex justify-between items-center mb-4 mt-2">
        <div class="flex items-center space-x-2 text-indigo-700">
            <i class="fa-solid fa-vial-circle-check text-xl"></i>
            <span class="font-bold text-lg">Microbe Test Quiz</span>
        </div>
        <button onclick="showImportScreen()" class="text-xs font-bold bg-white px-3 py-2 rounded-lg shadow-sm text-indigo-600 hover:bg-indigo-50 border border-indigo-100 flex items-center transition">
            <i class="fa-solid fa-file-import mr-2"></i> Load Deck
        </button>
    </header>

    <!-- PROGRESS INDICATOR -->
    <div id="progress-container" class="w-full max-w-md mb-2 flex justify-between items-end">
        <span id="card-counter" class="text-xs font-semibold uppercase tracking-wider text-gray-400">Loading...</span>
        <div class="flex items-center space-x-1">
            <div class="h-2 w-24 bg-gray-200 rounded-full">
                <div id="progress-bar" class="bg-green-500 h-2 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <!-- MAIN CARD AREA -->
    <div id="app-container" class="w-full max-w-md flex-grow flex flex-col relative">
        
        <!-- CARD -->
        <div id="quiz-card" class="bg-white rounded-3xl shadow-xl overflow-hidden flex flex-col relative border border-gray-200 transition-all duration-300 pb-6">
            
            <!-- Status Bar -->
            <div id="status-bar" class="h-2 w-full transition-colors duration-300 bg-indigo-400"></div>

            <!-- Question Area -->
            <div class="p-6 pb-2 text-center z-10">
                <h2 class="text-xs uppercase tracking-widest text-gray-400 mb-3 font-bold">Term / Question</h2>
                <div id="question-text" class="text-lg font-bold text-gray-800 fade-in min-h-[4rem] flex items-center justify-center">
                    Loading...
                </div>
            </div>

            <!-- Options Area -->
            <div id="options-container" class="px-6 py-2 space-y-3 flex-grow flex flex-col justify-center">
                <!-- Options injected by JS -->
            </div>

            <!-- Bottom Actions -->
            <div class="px-6 pt-4 mt-2 border-t border-gray-100 flex justify-center min-h-[60px] items-center">
                
                <!-- I Don't Know Button -->
                <button id="idk-btn" onclick="handleIDontKnow()" class="text-sm font-semibold text-gray-400 hover:text-red-500 transition flex items-center py-2 px-4 rounded-full hover:bg-red-50">
                    <i class="fa-regular fa-face-frown mr-2"></i> I don't know
                </button>

                <!-- Next Button (Hidden initially) -->
                <button id="next-btn" onclick="advanceCard()" class="hidden w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold shadow-md transition-all flex justify-center items-center transform active:scale-[0.98] animate-pulse">
                    Next Question <i class="fa-solid fa-arrow-right ml-2"></i>
                </button>

            </div>
        </div>

    </div>

    <!-- COMPLETION SCREEN (Hidden) -->
    <div id="completion-screen" class="hidden fixed inset-0 bg-green-50 z-50 flex flex-col items-center justify-center p-6 text-center">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-sm w-full">
            <i class="fa-solid fa-trophy text-6xl text-yellow-500 mb-6 animate-bounce"></i>
            <h1 class="text-3xl font-bold text-green-800 mb-2">Quiz Complete!</h1>
            <p class="text-gray-600 mb-8">You've mastered all the terms.</p>
            <div class="space-y-3 w-full">
                <button onclick="restartDefault()" class="w-full flex items-center justify-center px-6 py-3 bg-green-600 text-white rounded-xl font-bold shadow-lg hover:bg-green-700 transition">
                    <i class="fa-solid fa-rotate-right mr-2"></i> Restart Quiz
                </button>
                <button onclick="showImportScreen()" class="w-full flex items-center justify-center px-6 py-3 bg-white text-indigo-600 border border-indigo-200 rounded-xl font-bold shadow-sm hover:bg-indigo-50 transition">
                    <i class="fa-solid fa-upload mr-2"></i> Load New Deck
                </button>
            </div>
        </div>
    </div>

    <!-- IMPORT MODAL (Hidden) -->
    <div id="import-screen" class="hidden fixed inset-0 bg-gray-50 z-50 flex flex-col items-center p-6 overflow-y-auto">
        <div class="w-full max-w-xl bg-white p-8 rounded-2xl shadow-xl mt-10">
            <button onclick="hideImportScreen()" class="flex items-center text-gray-500 hover:text-indigo-600 mb-6 transition">
                <i class="fa-solid fa-arrow-left mr-2"></i> Back to Quiz
            </button>

            <h2 class="text-2xl font-bold text-indigo-800 mb-4 flex items-center">
                <i class="fa-solid fa-upload mr-2"></i> Load Custom Deck
            </h2>

            <div class="mb-6">
                <label class="block text-sm font-semibold mb-2 text-gray-700">Upload Text File (.txt)</label>
                <input type="file" id="file-upload" accept=".txt" class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/>
            </div>

            <div class="relative flex py-2 items-center">
                <div class="flex-grow border-t border-gray-300"></div>
                <span class="flex-shrink-0 mx-4 text-gray-400 text-xs">OR PASTE TEXT</span>
                <div class="flex-grow border-t border-gray-300"></div>
            </div>

            <div class="mb-6 mt-4">
                <textarea id="paste-area" class="w-full h-48 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent font-mono text-sm" placeholder="Term 1&#10;Answer 1&#10;Term 2&#10;Answer 2"></textarea>
            </div>

            <button onclick="processImport()" class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl shadow-md transition transform active:scale-95">
                Start Quiz
            </button>
        </div>
    </div>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- DATA WITH CURATED DISTRACTORS (28 CARDS) ---
        const defaultData = [
          { 
            term: "The carbohydrate test uses what indicator dye", 
            answer: "Phenol red",
            distractors: ["Methyl red", "Kovac’s reagent", "Bromothymol blue (used in Citrate)"]
          },
          { 
            term: "A yellow carbohydrate test tube indicates", 
            answer: "Acid production, lowering the pH",
            distractors: ["Gas production from fermentation", "Positive for mixed acid fermentation pathway", "Presence of indole"]
          },
          { 
            term: "A bubble in a durham tube indicates", 
            answer: "Gas production from fermentation",
            distractors: ["Acid production (Lowering of pH)", "Degradation of tryptophan", "Utilization of citrate as sole carbon source"]
          },
          { 
            term: "The carbohydrate test requires incubation of", 
            answer: "24 hours",
            distractors: ["3 to 5 days (MR/VP)", "30 minutes (VP reagent reaction)", "48 hours"]
          },
          { 
            term: "The methyl red test uses what indicator dye", 
            answer: "Methyl red",
            distractors: ["Phenol red (Carbohydrate/MSA)", "Bromothymol blue (Citrate)", "Kovac’s reagent (Indole)"]
          },
          { 
            term: "A red color in the methyl red test tube indicates", 
            answer: "Positive for mixed acid fermentation pathway",
            distractors: ["Presence of 2,3-butanediol (VP)", "Negative result (yellow/orange)", "Indicates ability to ferment mannitol"]
          },
          { 
            term: "The methyl red test requires incubation for", 
            answer: "3 to 5 days",
            distractors: ["24 hours (Carbohydrate)", "30 minutes (VP reading)", "7 days"]
          },
          { 
            term: "The Voges-Proskauer test requires what reagents?", 
            answer: "Barrett’s reagent A (alpha-naphthol) and Barrett's reagent B (KOH)",
            distractors: ["Kovac’s reagent (Indole)", "Ferric ammonium citrate", "Phenol red and a Durham tube"]
          },
          { 
            term: "The Voges-Proskauer test requires incubation for", 
            answer: "3 to 5 days",
            distractors: ["24 hours (Carbohydrate)", "Only 30 minutes (Reagent reaction time)", "12 hours"]
          },
          { 
            term: "The formation of a red layer at the top in the Voges-Proskauer test indicates", 
            answer: "Presence of 2,3-butanediol (from acetoin)",
            distractors: ["Degradation of tryptophan to indole", "Positive for mixed acid fermentation pathway (MR)", "Utilization of citrate as sole carbon source"]
          },
          { 
            term: "The VP test requires which precise procedural step?", 
            answer: "Shaking for 30 minutes after adding both Barrett's reagents to facilitate oxidation",
            distractors: ["Adding mineral oil to create an anaerobic environment", "Incubating in an ice bath to precipitate acids", "Adding ferrous salts to detect H₂S"]
          },
          { 
            term: "The Simmons Citrate slant turning blue indicates", 
            answer: "The organism used citrate as its only carbon source",
            distractors: ["The organism fermented glucose", "The organism degraded tryptophan", "The organism produced hydrogen sulfide"]
          },
          { 
            term: "The Simmons Citrate slant turns blue because", 
            answer: "The medium becomes more alkaline (raising pH) as ammonium salts are degraded",
            distractors: ["Acid production causes the Phenol Red indicator to change color", "It indicates the presence of tryptophanase", "The breakdown of citrate produces sulfuric acid"]
          },
          { 
            term: "Kliger’s Iron Agar (KIA) red slant/yellow butt indicates", 
            answer: "Only glucose was utilized (no lactose), with H₂S negative",
            distractors: ["The organism fermented both glucose and lactose", "No fermentation of either sugar occurred", "Production of hydrogen sulfide"]
          },
          { 
            term: "Kliger’s Iron Agar (KIA) yellow slant/yellow butt indicates", 
            answer: "The organism fermented both glucose and lactose",
            distractors: ["Only glucose was utilized", "No fermentation of either sugar occurred", "Degradation of peptone only"]
          },
          { 
            term: "Kliger’s Iron Agar (KIA) red slant/red butt indicates", 
            answer: "No fermentation of either glucose or lactose occurred",
            distractors: ["Production of hydrogen sulfide", "Only glucose was utilized", "Fermentation of peptone only"]
          },
          { 
            term: "Kliger’s Iron Agar (KIA) red slant/black butt indicates", 
            answer: "Production of hydrogen sulfide (H₂S)",
            distractors: ["Positive for mixed acid fermentation pathway", "Fermentation of both sugars", "Tryptophan degradation"]
          },
          { 
            term: "The indole test requires what reagent", 
            answer: "Kovac’s reagent",
            distractors: ["Barrett’s reagent A", "Methyl red", "Phenol red"]
          },
          { 
            term: "A red or pink layer in the indole test indicates", 
            answer: "Presence of indole, meaning the organism possesses tryptophanase",
            distractors: ["Positive for mixed acid fermentation pathway", "Utilization of citrate as sole carbon source", "Presence of 2,3-butanediol"]
          },
          { 
            term: "Mannitol Salt Agar (MSA) is classified as", 
            answer: "Selective (for halophiles) and differential (for mannitol fermentation)",
            distractors: ["Enriched and differential", "Selective (for G- bacteria) and enriched", "Only differential (allows all growth)"]
          },
          { 
            term: "MSA only allows for growth of", 
            answer: "Halophiles due to high salt concentration",
            distractors: ["Gram-negative bacteria due to crystal violet (MacConkey)", "Fastidious bacteria due to sheep’s blood (Blood Agar)", "Organisms that ferment both glucose and lactose"]
          },
          { 
            term: "MSA contains what dye that indicates mannitol fermentation?", 
            answer: "Phenol red, which turns the agar yellow",
            distractors: ["Crystal violet, which turns reddish if the organism ferments lactose", "Sheep’s blood, which allows viewing of hemolysis", "Methyl red, which turns red if mixed acid fermentation is positive"]
          },
          { 
            term: "MSA is specifically used to differentiate between", 
            answer: "Species of Staphylococcus",
            distractors: ["Coliforms and non-coliforms", "G- bacteria (MacConkey)", "Organisms that require X and V factors"]
          },
          { 
            term: "Blood Agar is classified as", 
            answer: "Enriched (5% sheep’s blood) and differential (for hemolysis)",
            distractors: ["Selective and differential", "Only enriched", "Used primarily to differentiate G- organisms"]
          },
          { 
            term: "Blood Agar allows us to view the microorganism’s", 
            answer: "Level of hemolysis (alpha, beta, or gamma)",
            distractors: ["Ability to produce H₂S", "Ability to ferment mannitol", "Ability to utilize citrate"]
          },
          { 
            term: "MacConkey Agar is classified as", 
            answer: "Selective (for G- bacteria) and differential (for lactose fermentation)",
            distractors: ["Enriched and differential", "Selective (for halophiles) and differential", "Used only to detect H₂S production"]
          },
          { 
            term: "MacConkey Agar only allows for growth of", 
            answer: "G- bacteria due to the presence of crystal violet",
            distractors: ["Halophiles due to high salt concentration", "Fastidious bacteria", "G+ cocci"]
          },
          { 
            term: "MacConkey Agar changes color to what and why?", 
            answer: "Turns reddish/pink when grown with bacteria that can ferment lactose (due to acid production)",
            distractors: ["Turns blue due to alkalinity from citrate utilization", "Turns black due to H₂S production", "Turns yellow due to mannitol fermentation"]
          }
        ];

        // --- STATE ---
        let queue = [];
        let masteredCount = 0;
        let totalCards = 0;
        let isLocked = false; 

        // --- INIT ---
        window.onload = function() {
            initDeck(defaultData);
            
            // File Upload Listener
            document.getElementById('file-upload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('paste-area').value = e.target.result;
                };
                reader.readAsText(file);
            });
        };

        function shuffle(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        function initDeck(data) {
            const formatted = data.map((item, idx) => ({
                ...item,
                id: idx,
                score: 0
            }));
            
            queue = shuffle(formatted);
            masteredCount = 0;
            totalCards = queue.length;
            isLocked = false;
            
            render();
        }

        // --- CORE LOGIC ---
        function render() {
            const completionScreen = document.getElementById('completion-screen');
            const appContainer = document.getElementById('app-container');

            if (queue.length === 0 && totalCards > 0) {
                completionScreen.classList.remove('hidden');
                appContainer.classList.add('hidden');
                return;
            } else {
                completionScreen.classList.add('hidden');
                appContainer.classList.remove('hidden');
            }

            if(queue.length === 0) return;

            const currentCard = queue[0];
            const statusBar = document.getElementById('status-bar');
            
            document.getElementById('question-text').innerText = currentCard.term;

            if (currentCard.score === 0) {
                statusBar.classList.remove('bg-yellow-400');
                statusBar.classList.add('bg-indigo-400');
            } else {
                statusBar.classList.remove('bg-indigo-400');
                statusBar.classList.add('bg-yellow-400');
            }

            document.getElementById('card-counter').innerText = `Left: ${queue.length}`;
            const pct = (masteredCount / totalCards) * 100;
            document.getElementById('progress-bar').style.width = `${pct}%`;

            document.getElementById('idk-btn').classList.remove('hidden');
            document.getElementById('next-btn').classList.add('hidden');

            // GENERATE OPTIONS: Use curated distractors if available, otherwise fallback (for imported decks)
            const correct = currentCard.answer;
            let options;
            
            if (currentCard.distractors && currentCard.distractors.length === 3) {
                 options = shuffle([...currentCard.distractors, correct]);
            } else {
                 // Fallback logic for imported cards without manual distractors (using random answers from the whole deck)
                 let allAnswers = defaultData.map(i => i.answer).concat(queue.slice(1).map(i => i.answer));
                 let uniqueAnswers = [...new Set(allAnswers)];
                 let distractors = uniqueAnswers.filter(a => a !== correct);
                 distractors = shuffle(distractors).slice(0, 3);
                 options = shuffle([...distractors, correct]);
            }

            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';

            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full p-4 text-left bg-white border-2 border-gray-100 rounded-xl font-medium text-gray-600 hover:border-indigo-300 hover:bg-indigo-50 shadow-sm text-sm";
                btn.innerText = opt;
                btn.onclick = () => handleAnswer(opt, correct, btn);
                optionsContainer.appendChild(btn);
            });
            
            isLocked = false;
        }

        function showNextButton() {
             document.getElementById('idk-btn').classList.add('hidden');
             document.getElementById('next-btn').classList.remove('hidden');
        }

        function handleAnswer(selected, correct, btnElement) {
            if (isLocked) return;
            isLocked = true;

            const isCorrect = (selected === correct);
            const currentCard = queue[0];

            if (isCorrect) {
                btnElement.classList.add('correct-answer');
                currentCard.score += 1;
            } else {
                if(btnElement) btnElement.classList.add('wrong-answer');
                
                const allBtns = document.querySelectorAll('.option-btn');
                allBtns.forEach(b => {
                    if (b.innerText === correct) {
                        b.classList.add('correct-answer');
                    }
                });
                
                currentCard.score = 0;
            }
            
            showNextButton();
        }

        function handleIDontKnow() {
            if (isLocked) return;
            isLocked = true;
            
            const currentCard = queue[0];
            const correct = currentCard.answer;

            const allBtns = document.querySelectorAll('.option-btn');
            allBtns.forEach(b => {
                if (b.innerText === correct) {
                    b.classList.add('correct-answer');
                }
            });

            currentCard.score = 0;
            showNextButton();
        }

        function advanceCard() {
            const card = queue.shift();
            
            if (card.score >= 1) {
                 masteredCount++;
            } else {
                queue.push(card);
            }

            render();
        }

        function restartDefault() {
            initDeck(defaultData);
        }

        // --- IMPORT LOGIC ---
        function showImportScreen() {
            document.getElementById('import-screen').classList.remove('hidden');
        }

        function hideImportScreen() {
            document.getElementById('import-screen').classList.add('hidden');
        }

        function processImport() {
            const raw = document.getElementById('paste-area').value;
            if (!raw.trim()) return;

            const lines = raw.split(/\r?\n/).filter(line => line.trim() !== '');
            const newCards = [];

            // Parse: Line 1 = Term, Line 2 = Answer
            for (let i = 0; i < lines.length; i += 2) {
                if (lines[i] && lines[i+1]) {
                    newCards.push({
                        term: lines[i].trim(),
                        answer: lines[i+1].trim(),
                        // Distractors will be generated randomly for imported cards
                        distractors: [] 
                    });
                }
            }

            if (newCards.length > 0) {
                initDeck(newCards);
                hideImportScreen();
            } else {
                alert("Could not find valid card pairs. Make sure you have a Question on one line and an Answer on the next.");
            }
        }
    </script>
</body>
</html>